<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">

    <link rel="icon" href="/practices/favicon.png">

    <meta property='og:image' content="https://devgeniem.github.io/practices/images/gdev-logo.png"/>
    <meta property='og:url' content="https://devgeniem.github.io/kehitys/javascript/">
    <link rel="image_src" href="https://devgeniem.github.io/practices/images/gdev-logo.png" / >
    <link rel="shortcut icon" href="https://devgeniem.github.io/practices/favicon.png">

    <title>Geniem Best Practices : JavaScript</title>
    <meta property='og:title' content="Geniem Best Practices : JavaScript"/>
    <meta property='og:site_name' content="Best Practices">
    <meta property="og:type" content="website" />

    
        <meta property='og:description' content="Suorituskyky

"/>
        <meta name='twitter:description' content="Suorituskyky

"/>
    

    <meta name="twitter:site" content="@Geniemfi">
    <meta name="summary" content="twitter:card">
    <meta name='twitter:title' content="Geniem Best Practices : JavaScript"/>
    <meta name="twitter:image:src" content="https://devgeniem.github.io/practices/images/gdev-logo.png">


    <meta name="description" content="Ohjeet hyvään kehitykseen">

    
    <meta name="google-site-verification" content="" />
    

    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');
</script>

    
    <script src="https://code.jquery.com/jquery-2.1.4.min.js" type="text/javascript"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/practices/assets/main.css">
    <link href='https://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>

</head>

    <body>
        <div class="container">
            <div class="row">
                <div id="header" class="col-sm-12">
                    <div class="row header-bar">
  <div class="col-md-8 col-sm-8">
    <h4><a class="brand" href="/practices/">Geniem Best Practices</a>
        <small>Ohjeet hyvään kehitykseen</small>
    </h4>
  </div>
  <div class="col-md-4 col-sm-4">

  </div>
</div>

                </div>
            </div>

            <div class="row">
                
                
                    <div id="navigation" class="col-sm-2">
                        <!-- Html Elements for Search -->
<div id="search-container">
  <input type="text" id="search-input" class="btn btn-default" placeholder="Etsi...">
</div>

<ul class="nav nav-list">
    <li class="nav-header">Best Practices</li>
    <li class=><a href="/practices/">Johdanto</a></li>
    <li class="divider"></li>
    
        
        

        
            

            
                
                    
                        <li class="nav-header">Kehitys</li>
                    
                    <li data-order="1"><a href="/practices/kehitys/html/">HTML</a></li>
                
            
                
                    
                    <li data-order="2"><a href="/practices/kehitys/css/">CSS</a></li>
                
            
                
                    
                    <li data-order="3"><a href="/practices/kehitys/javascript/">JavaScript</a></li>
                
            
                
                    
                    <li data-order="4"><a href="/practices/kehitys/php/">PHP</a></li>
                
            
            
                <li class="divider"></li>
            
        
    
        
        

        
            

            
                
                    
                        <li class="nav-header">Design</li>
                    
                    <li data-order="1"><a href="/practices/design/ux/">UX</a></li>
                
            
                
                    
                    <li data-order="2"><a href="/practices/design/prototyypit/">Prototyypit</a></li>
                
            
                
                    
                    <li data-order="3"><a href="/practices/design/testaus/">Testaus</a></li>
                
            
            
                <li class="divider"></li>
            
        
    
        
        

        
    
        
        

        
            

            
                
                    
                        <li class="nav-header">Projektit & työkalut</li>
                    
                    <li data-order="1"><a href="/practices/tyokalut/rakenne/">Projektin rakenne</a></li>
                
            
                
                    
                    <li data-order="2"><a href="/practices/tyokalut/kehitys/">Kehityksen työkalut</a></li>
                
            
                
                    
                    <li data-order="3"><a href="/practices/tyokalut/versionhallinta/">Versionhallinta</a></li>
                
            
                
                    
                    <li data-order="4"><a href="/practices/tyokalut/dokumentointi/">Dokumentointi</a></li>
                
            
            
        
    
    <!-- List additional links. It is recommended to add a divider
    e.g. <li class="divider"></li> first to break up the content. -->
</ul>

                    </div>
                    <div id="content" class="col-sm-10">
                        <div class="page-header">
      <div class="row">
        <div class="col-md-7">
          <h1>JavaScript
              
          </h1>
        </div>
        <div class="col-md-5 edit-buttons">
          <a href="https://github.com/devgeniem/practices/edit/gh-pages/_posts/2016-12-09-javascript.md" class="btn btn-default pull-right-md pull-left-sm">
    <i class="glyphicon glyphicon-file"></i> Muokkaa
</a>

        </div>
      </div>
</div>



<h3 id="suorituskyky">Suorituskyky</h3>

<p>Suorituskykyisen JavaScriptin kirjoittaminen on erittäin tärkeää. Huono ja raskas JavaScript kuormittaa käyttäjän selainta ja saattaa jopa kaataa ohjelman. Mobiiliyhteyksillä tämä korostuu erityisesti, joten JS:n toiminnallisuus ja hyvä suorituskyky täytyy pitää mielessä koko kehitysprosessin ajan.</p>

<p>Monissa Geniemin projekteissa, kuten kaikissa WordPress-projekteissa, käytetään <a href="http://jquery.com/">jQueryä</a>. JQueryssä on monia hyviä puolia, kuten sen tarjoama AJAX-käsittely ja JS:n kääntyminen  selaimille yhtenäisellä tavalla ymmärrettäväksi koodiksi.</p>

<p>JQueryn kanssa voi kuitenkin helposti tehdä varsin raskasta koodia. Pitää olla tarkkana, ettei esim. hae jokaista DOM-elementtiä classinsa mukaan monta kertaa uudestaan saman koodin aikana, vaan huolehtii elementtien ajonaikaisesta cachetuksesta ja oikeaoppisesta DOM:in käsittelystä.</p>

<h3 id="kyt-jquery-harkiten">Käytä jQueryä harkiten</h3>

<p>Monissa tapauksissa jQueryn käyttö elementtien manipulointiin voi olla turhaa. Alla esimerkki, jossa elementin piilottamisen voi hoitaa vain JavaScriptillä, mikä on tehokkaampaa.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span> <span class="s1">'element'</span> <span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">'none'</span><span class="p">;</span>
</code></pre>
</div>

<p>vs.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">jQuery</span><span class="p">(</span> <span class="s1">'#element'</span> <span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
</code></pre>
</div>

<h3 id="elementin-asetus-jquery-objektiksi">Elementin asetus jQuery-objektiksi</h3>

<p>Kun jqueryllä haetaan DOMista elementti, tekee se siitä taustalla jQuery-objektin</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">jQuery</span><span class="p">(</span> <span class="s1">'#menu'</span> <span class="p">);</span>
</code></pre>
</div>

<p>Vaihtoehtoisesti jQuerylle voi antaa manuaalisesti <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLCollection">kokoelman elementtejä</a> tai <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement">elementin</a> vastaavanlaisen jQuery-objektin luomiseksi. Tämä on suorituskyvyllisesti <a href="http://jsperf.com/wrap-an-element-or-html-collection-in-jquery">nopeampaa.</a></p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">// Elementti haetaan ID:llä</span>
<span class="nx">jQuery</span><span class="p">(</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span> <span class="s1">'menu'</span> <span class="p">)</span> <span class="p">);</span>

<span class="c1">// Elementti haetaan käyttäen "querySelector"-metodia</span>
<span class="c1">// Classeille hyvä, joskin classien avulla EI kannata hakea elementtejä, jos ei ole pakko.</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#menu'</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">'.menu-item'</span><span class="p">);</span>
</code></pre>
</div>

<h3 id="domin-cachetus">DOMin cachetus</h3>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>
<span class="nx">app</span><span class="p">.</span><span class="nx">$element</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span> <span class="s1">'#element'</span> <span class="p">);</span>

<span class="c1">// Muuta koodia...</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">$element</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">'element--state'</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">$element</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s1">'#child-element'</span><span class="p">);</span>
<span class="c1">// DOM node on cachessa, joten sitä ei haeta uusiksi joka kerta</span>

</code></pre>
</div>

<h3 id="js-malli">JS-malli</h3>

<p>Geniem käyttää javascript-tiedostojensa koodin jäsentämiseen alla olevaa mallia. Ideana mallissa on se, että yhden sivun JS on yhden olion sisällä metodeina, ja olio palautetaan myös window:n alle. Täten voidaan helposti cachettaa olion käyttämät DOM-elementit ja hallita olion metodeja järjestelmällisesti.</p>

<p>Malli on kommentoitu ja se sisältää muutaman hyödyllisen esimerkin. Mallin koodi on projektien boilerplatejen JS-puolella valmiina.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>
<span class="c1">// Luodaan olio ja annetaan sille parametreinä käyttöön window, document ja jQuery. jQuery on mapatty dollarimerkkiin oletuksena.</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">SivunOlio</span> <span class="o">=</span> <span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nb">window</span><span class="p">,</span> <span class="nb">document</span><span class="p">,</span> <span class="nx">$</span> <span class="p">){</span>

    <span class="c1">// Viittaus olioon sisäisesti.</span>
    <span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="c1">// Olion muuttujien cachetusfunktio. DOM-elementit haetaan olion käyttöön ajonaikaiseen cacheen.</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">cache</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>

        <span class="c1">// Muuttuja prefixataan dollarimerkillä, jotta tiedetään, että se on jQuery-objekti.</span>
        <span class="nx">app</span><span class="p">.</span><span class="nx">$element</span>            <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#element'</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">'ajaxurl'</span><span class="p">);</span>
        <span class="c1">// Muuttujiin voi asettaa mitä vain dataa.</span>
        <span class="nx">app</span><span class="p">.</span><span class="nx">elementData</span>         <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#element'</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">'ajaxurl'</span><span class="p">);</span>
        <span class="nx">app</span><span class="p">.</span><span class="kr">boolean</span>             <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="c1">// Olion init-metodi. Asetetaan funktio muuttujaan, mikä on suorituskykyisempää, kuin irtonaiset funktion deklaraatiot.</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="c1">// Kutsutaan cachetusmetodia</span>
        <span class="nx">app</span><span class="p">.</span><span class="nx">cache</span><span class="p">();</span>
        <span class="c1">// Kutsutaan olion metodia</span>
        <span class="nx">app</span><span class="p">.</span><span class="nx">method1</span><span class="p">();</span>
        <span class="c1">// Asetetaan event handler cachetetulle elementille. Esimerkissä mukana parametrien välitys handler-metodille.</span>
        <span class="nx">app</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="s1">'click'</span><span class="p">,</span> <span class="p">{</span> <span class="na">passedParameter</span><span class="p">:</span> <span class="s2">"value"</span> <span class="p">},</span> <span class="nx">app</span><span class="p">.</span><span class="nx">method2</span> <span class="p">);</span>

    <span class="p">};</span>

    <span class="c1">// Metodin koodi</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">method1</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

        <span class="c1">// Koodia...</span>
    <span class="p">};</span>

    <span class="c1">// Eventhandler -metodin koodi. Esimerkkinä event datan lisäksi metodin saama parametri</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">method2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">functionParam1</span> <span class="p">){</span>

        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>

        <span class="c1">// Annettu event data muuttujaan.</span>
        <span class="kd">var</span> <span class="nx">param1</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">passedParameter</span><span class="p">;</span>

        <span class="c1">// Annettu parametri muuttujaan.</span>
        <span class="kd">var</span> <span class="nx">param2</span> <span class="o">=</span> <span class="nx">functionParam1</span><span class="p">;</span>

        <span class="c1">// Koodia...</span>

    <span class="p">};</span>

    <span class="c1">// Ajetaan olion init-metodi document readyssä.</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

        <span class="nx">app</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>

    <span class="p">});</span>

    <span class="c1">// Palautetaan olio window:lle. Olioon viitataan muualla käyttäen: "window.SivunOlio".</span>
    <span class="k">return</span> <span class="nx">app</span><span class="p">;</span>

<span class="p">})(</span> <span class="nb">window</span><span class="p">,</span> <span class="nb">document</span><span class="p">,</span> <span class="nx">jQuery</span> <span class="p">);</span>
</code></pre>
</div>

<h3 id="koodin-kommentointi">Koodin kommentointi</h3>

<p>Koodin kommentointi on yksi tärkeimmistä käytännöistä ylläpidettävyyden ja jatkokehitettävyyden kannalta. Kommentoimalla koodiasi kattavasti ja yksiselitteisesti varmistat, että toisetkin ymmärtävät mitä olet kirjoittanut. Kirjoita kommentteja koodiin mieluummin liikaa kuin liian vähän.</p>

<h3 id="koodaustyylit">Koodaustyylit</h3>

<p>Geniemin JavaScript-koodaustyylejä valvotaan Geniemin <a href="http://jscs.info/">JSCS</a>-konfiguraatiolla. Konfiguraatiotiedostoa käytetään Sublime Linterissä, jolloin koodaustyylivirheet näkee heti koodia kirjoittaessa. Katso ohjeet <a href="/practices">työkalut</a>-sivulta. Alla muutama poiminta linterin pakottamista säännöistä.</p>

<ul>
  <li>Muuttujien ja metodien nimeämisessä käytetään camelCasea.</li>
  <li>Olioiden ja niiden metodien sekä muuttujien nimeäminen tulee olla kuvaavaa ja tarpeeksi tarkkaa.</li>
  <li>Rivinvaihtoja käytetään siten, että koodi on selkeästi jäsenneltyä.</li>
  <li>Välilyöntejä käytetään runsaasti, esim. metodin parametrien ja sulkujen välillä sekä if-ehtolausekkeissa.</li>
</ul>



                    </div>
                    <!--googleoff: all -->
                    <div class="col-sm-10" id="search-results-box" style="display: none">
                        <div class="search-header">
                            <h1>Hakutulokset</h1>
                        </div>
                        <ul id="results-container"></ul>
                    </div>
                    <!--googleon: all -->

                
            </div>

            

            <div class="row">
                <div id="footer" class="col-sm-12">
                    <p>Dokumentaation projektiin <a href="https://github.com/devgeniem/practices">Best Practices</a> tuottanut <a href="http://geniem.fi/">Geniem Oy</a>.</p>

<!-- Script pointing to jekyll-search.js -->
<script src="/practices/bower_components/simple-jekyll-search/dest/jekyll-search.js" type="text/javascript"></script>
<script src="/practices/assets/main.js" type="text/javascript"></script>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
        
    </body>
</html>
